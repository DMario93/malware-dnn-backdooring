This repository contains the code related to the paper
**Lookin' Out My Backdoor! Investigating Backdooring Attacks
Against DL-Driven Malware Detectors**.

If using this repo, please cite our paper:

    @inproceedings{
    malware_dnn_backdooring,
    author = {D'Onghia, Mario and Di Cesare, Federico and Gallo, Luigi and Carminati, Michele and Polino, Mario and Zanero, Stefano},
    title = {Lookin' Out My Backdoor! Investigating Backdooring Attacks Against DL-Driven Malware Detectors},
    year = {2023},
    isbn = {9798400702600},
    publisher = {Association for Computing Machinery},
    url = {https://doi.org/10.1145/3605764.3623919},
    doi = {10.1145/3605764.3623919},
    booktitle = {Proceedings of the 16th ACM Workshop on Artificial Intelligence and Security},
    pages = {209â€“220},
    series = {AISec '23}
    }

### Running single scripts

After cloning the repo and installing all requirements, run
each script as:

    python -m module1.module2.script

## Adaptive trigger attack

To generate a latent trigger:

    python -m attacks.latent_trigger.trigger_generation_mixed.trigger_generator malconv path_to_malconv_model min_features<int> max_features<int> fp_score<float> malware_distance<float> goodware_distance<float>

Refer to the paper if in doubt to what these params mean.

To generate poisoning samples:

(The following helps to speed up the injection by precomputing input level triggers. Triggers can be still computed dynamically for each sample. Run only once).

    python -m attacks.latent_trigger.trigger_generation_mixed.static_trigger_precomputer model_name, model_path, trigger_path, trigger_goodware_indices_path, trigger_malware_indices_path

    python -m attacks.latent_trigger.binary_generation.binary_generator model_name, model_path, dataset_dir, output_dir, trigger_path, trigger_indices_path_1, trigger_indices_path_2, pre_computed_dict_path, threshold

To implant the backdoor:

    python -m attacks.latent_trigger.poisoned_training malconv clean_malconv_path clean_dataset_dir poisoning_samples_dir validation_dir save_path
