import numpy as np
import matplotlib.pyplot as plt


def make_plot_attack():
    plt.rc("text", usetex=True)
    plt.rc("font", family="serif")
    plt.rc("font", serif=["Computer Modern Serif"])

    x_axis = [0.0, 0.1, 0.2, 0.3, 0.4, 0.5]
    x_axis[0] = 0.0025
    x_axis[-1] = 0.475
    y_axis = np.arange(10, 110, 10)
    fig, ax = plt.subplots()

    mixed_feats = [10, 100, 100, 100, 100, 100]
    benign_feats = [10, 88, 97, 90, 93, 100]
    ax.plot(x_axis[:], mixed_feats, "o--", color='r', linewidth=4.0, markersize=14, label=f"MalConv - Mixed Feats")
    ax.plot(x_axis[:], benign_feats, "o--", color="orange", linewidth=4.0, markersize=14, label=f"MalConv - Benign Feats")

    for index, (x, y) in enumerate(zip(x_axis[1:], mixed_feats[1:])):
        plt.annotate(f"{y}", (x, y), textcoords="offset points", xytext=(0, 10), ha='center', fontsize=25)

    for index, (x, y) in enumerate(zip(x_axis[:], benign_feats)):
        if index == 2:
            plt.annotate(f"{y}", (x, y), textcoords="offset points", xytext=(0, -25), ha='center', fontsize=25)
        else:
            plt.annotate(f"{y}", (x, y), textcoords="offset points", xytext=(0, 10), ha='center', fontsize=25)

    ax.set_xticks([0.0, 0.1, 0.2, 0.3, 0.4, 0.5], ["0.0", "0.1", "0.2", "0.3", "0.4", "0.5"], fontsize=30)
    ax.set_yticks(np.arange(0, 101, 10), np.arange(0, 101, 10), fontsize=30)
    ax.set_xlabel("poisoning samples (\% of total training dataset)", fontsize=32)
    ax.set_ylabel("undetected triggered samples (\%)", fontsize=32)

    ax.set(xlim=(0.0, 0.52), xticks=np.arange(0., 0.52, 0.1), ylim=(0, 110), yticks=y_axis)
    ax.set_title(f"Clean Label - Full Knowledge", fontsize=40)
    ax.legend(loc="lower right", fontsize=32)
    ax.grid()
    plt.show()


def make_plot_clean_label_2000():
    x_axis = np.arange(0., 0.45, 0.05)
    x_axis[0] = 0.0025
    x_axis[-1] = 0.3975
    y_axis = np.arange(0, 45, 5)
    fig, ax = plt.subplots()

    avastnet_result = [2.2, 39.4, 18.8, 17.7, 25.3, 34.1, 16.1, 20.4, 12.2]
    malconv_results = [3.4, 3.0, 7.0, 7.6, 8.0, 8.3, 8.5, 3.0, 2.5]

    ax.plot(x_axis[:], avastnet_result, "o--", color='r', linewidth=4.0, markersize=14, label=f"AvastNet")
    ax.plot(x_axis[:], malconv_results, "o--", color="orange", linewidth=4.0, markersize=14, label=f"MalConv")

    plt.annotate(f"{avastnet_result[0]}", (x_axis[0], avastnet_result[0]),
                 textcoords="offset points", xytext=(0, -28), ha="center", fontsize=25)
    for x, y in zip(x_axis[1:], avastnet_result[1:]):
        plt.annotate(f"{y}", (x, y), textcoords="offset points", xytext=(0, 10), ha='center', fontsize=25)
    plt.annotate(f"{avastnet_result[-1]}", (x_axis[-2], avastnet_result[-1] - 3),
                 textcoords="offset points", xytext=(0, 10), ha="center", fontsize=25)
    for x, y in zip(x_axis[:], malconv_results):
        plt.annotate(f"{y}", (x, y), textcoords="offset points", xytext=(0, 10), ha='center', fontsize=25)

    ax.set_xticks(np.arange(0., .45, .05), [f"{x}" for x in np.arange(0, 45, 5)], fontsize=30)
    ax.set_yticks(np.arange(10, 45, 5), np.arange(10, 45, 5), fontsize=30)
    ax.set_xlabel("poisoning samples (% of total training dataset)", fontsize=32)
    ax.set_ylabel("undetected triggered samples (%)", fontsize=32)

    ax.set(xlim=(0, 0.40), xticks=np.arange(0., 0.45, 0.05), ylim=(0, 40), yticks=y_axis)
    ax.set_title(f"2000-byte Trigger", fontsize=40)
    ax.legend(loc="upper right", fontsize=32)
    ax.grid()
    plt.show()


if __name__ == '__main__':
    # make_plot_clean_label_2000()
    make_plot_attack()
